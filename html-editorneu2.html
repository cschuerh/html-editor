<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schul-Code-Editor</title>
<style>
* { box-sizing: border-box; }
body { margin:0; font-family: "Fira Code", monospace; background:#1e1e1e; color:#ddd; height:100vh; display:flex; flex-direction:column; }
header { background:#2d2d2d; padding:0.5em 1em; display:flex; justify-content:space-between; align-items:center; font-weight:500; }
#autoUpdateLabel { font-size:0.9em; display:flex; align-items:center; gap:0.5em; }
#autoUpdate { transform:scale(1.2); }
main { flex:1; display:flex; overflow:hidden; }
#editors { display:flex; flex-direction:column; width:50%; background:#252526; border-right:2px solid #111; }
#tabs { display:flex; background:#333; }
#tabs button { flex:1; padding:0.7em; border:none; background:#333; color:#ccc; cursor:pointer; transition:0.2s; }
#tabs button.active { background:#1e1e1e; color:#fff; border-bottom:2px solid #00b0ff; }
textarea { flex:1; width:100%; padding:1em; font-family:"Fira Code", monospace; font-size:14px; color:#eee; background:#1e1e1e; border:none; outline:none; resize:none; }
#iframeContainer { width:50%; display:flex; flex-direction:column; }
iframe { flex:1; border:none; background:white; }
#console { height:120px; overflow:auto; background:#1e1e1e; color:#0f0; font-family:monospace; padding:5px; border-top:2px solid #111; }
#controls { padding:0.5em; background:#2d2d2d; text-align:right; display:flex; flex-wrap:wrap; gap:5px; }
button { background:#007acc; color:#fff; border:none; padding:0.4em 0.8em; border-radius:4px; cursor:pointer; font-size:0.9em; }
button:hover { background:#0094ff; }
#fileLoader { display:none; }
@media (max-width:800px) { main { flex-direction:column; } iframe,#editors { width:100%; height:50%; } }
</style>
</head>
<body>

<header>
  <div>ðŸ§© Schul-Code-Editor</div>
  <label id="autoUpdateLabel">
    <input type="checkbox" id="autoUpdate" checked> Automatisch aktualisieren
  </label>
</header>

<main>
  <div id="editors">
    <div id="tabs">
      <button class="active" data-target="html">HTML</button>
      <button data-target="css">CSS</button>
      <button data-target="js">JS</button>
    </div>

    <textarea id="html" class="code">
<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <title>Meine Seite</title>
    <!-- CSS wird nur Ã¼bernommen, wenn <link rel="stylesheet" href="style.css"> gesetzt ist -->
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Hallo Welt!</h1>
    <p>Willkommen im Schul-Editor ðŸ˜Š</p>
    <!-- Bilder/Videos per relativen Pfad -->
    <!-- <img src="bild.jpg"> -->
    <!-- <video src="video.mp4" controls></video> -->
  </body>
</html>
    </textarea>

    <textarea id="css" class="code" style="display:none;">
/* Hier CSS schreiben, entspricht style.css */
body {
  font-family: sans-serif;
  background: #f5f5f5;
  color: #333;
  text-align: center;
  margin-top: 50px;
}

h1 {
  color: #007acc;
}
    </textarea>

    <textarea id="js" class="code" style="display:none;">
console.log("JS lÃ¤uft!");
    </textarea>

    <div id="controls">
      <button id="updateBtn">ðŸ”„ Vorschau aktualisieren</button>
      <button id="saveBtn">ðŸ’¾ Projekt speichern</button>
      <button id="loadBtn">ðŸ“‚ Projekt laden</button>
      <input type="file" id="fileLoader">
      <!-- Einzelne Dateien speichern Buttons werden via JS hinzugefÃ¼gt -->
    </div>
  </div>

  <div id="iframeContainer">
    <iframe id="preview"></iframe>
    <div id="console"></div>
  </div>
</main>

<script>
const tabs = document.querySelectorAll("#tabs button");
const areas = document.querySelectorAll("textarea.code");
const iframe = document.getElementById("preview");
const updateBtn = document.getElementById("updateBtn");
const autoUpdate = document.getElementById("autoUpdate");
const consoleDiv = document.getElementById("console");
const saveBtn = document.getElementById("saveBtn");
const loadBtn = document.getElementById("loadBtn");
const fileLoader = document.getElementById("fileLoader");

let auto = true;

// Interne Konsole
function printToConsole(msg) {
  consoleDiv.innerHTML += msg + "<br>";
  consoleDiv.scrollTop = consoleDiv.scrollHeight;
}
const oldLog = console.log;
console.log = function(...args) {
  printToConsole(args.join(' '));
  oldLog.apply(console,args);
}

// Tabwechsel
tabs.forEach(btn => {
  btn.addEventListener("click", () => {
    tabs.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    areas.forEach(a=>a.style.display = a.id===btn.dataset.target ? "block" : "none");
  });
});

// Vorschau aktualisieren
function updatePreview() {
  let htmlCode = document.getElementById("html").value;
  const cssCode = document.getElementById("css").value;
  const jsCode = document.getElementById("js").value;
  const doc = iframe.contentDocument || iframe.contentWindow.document;

  // CSS nur Ã¼bernehmen, wenn <link rel="stylesheet" href="style.css"> vorhanden ist
  const linkRegex = /<link\s+rel=["']stylesheet["']\s+href=["']style\.css["'][^>]*>/i;
  if (linkRegex.test(htmlCode)) {
    const headEnd = htmlCode.search(/<\/head>/i);
    if (headEnd !== -1) {
      htmlCode = htmlCode.slice(0, headEnd) +
                 `<style>\n${cssCode}\n</style>\n` +
                 htmlCode.slice(headEnd);
    }
  }

  doc.open();
  doc.write(htmlCode);
  doc.write(`
    <script>
      try { ${jsCode} } catch(e){ console.error(e); }
    <\/script>
  `);
  doc.close();
}

// Auto-Update
updateBtn.addEventListener("click", updatePreview);
autoUpdate.addEventListener("change", e => auto=e.target.checked);
areas.forEach(a=>a.addEventListener("input",()=>{if(auto) updatePreview();}));

// Projekt speichern/laden
saveBtn.addEventListener("click", ()=>{
  const data = {
    html: document.getElementById("html").value,
    css: document.getElementById("css").value,
    js: document.getElementById("js").value
  };
  const blob = new Blob([JSON.stringify(data)], {type:"application/json"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "projekt.json";
  link.click();
});

loadBtn.addEventListener("click", ()=>fileLoader.click());
fileLoader.addEventListener("change", function(){
  const file=this.files[0];
  const reader=new FileReader();
  reader.onload=function(e){
    const data=JSON.parse(e.target.result);
    document.getElementById("html").value=data.html;
    document.getElementById("css").value=data.css;
    document.getElementById("js").value=data.js;
    updatePreview();
  };
  reader.readAsText(file);
});

// Einzelne Dateien speichern
function saveFile(filename, content) {
  const blob = new Blob([content], {type: "text/plain"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

const controlsDiv = document.getElementById("controls");

// HTML speichern
const saveHTMLBtn = document.createElement("button");
saveHTMLBtn.textContent = "ðŸ’¾ HTML speichern";
saveHTMLBtn.addEventListener("click", () => saveFile("index.html", document.getElementById("html").value));
controlsDiv.appendChild(saveHTMLBtn);

// CSS speichern
const saveCSSBtn = document.createElement("button");
saveCSSBtn.textContent = "ðŸ’¾ CSS speichern";
saveCSSBtn.addEventListener("click", () => saveFile("style.css", document.getElementById("css").value));
controlsDiv.appendChild(saveCSSBtn);

// JS speichern
const saveJSBtn = document.createElement("button");
saveJSBtn.textContent = "ðŸ’¾ JS speichern";
saveJSBtn.addEventListener("click", () => saveFile("script.js", document.getElementById("js").value));
controlsDiv.appendChild(saveJSBtn);

// HTML Auto-EinrÃ¼ckung
const htmlArea = document.getElementById("html");
htmlArea.addEventListener("keydown", function(e) {
  if(e.key === "Tab") {
    e.preventDefault();
    const start = this.selectionStart;
    const end = this.selectionEnd;
    this.value = this.value.substring(0,start) + "\t" + this.value.substring(end);
    this.selectionStart = this.selectionEnd = start + 1;
  }
  if(e.key === "Enter") {
    e.preventDefault();
    const start = this.selectionStart;
    const lineStart = this.value.lastIndexOf("\n", start-1)+1;
    const currentLine = this.value.substring(lineStart, start);
    const indentMatch = currentLine.match(/^\s*/);
    let indent = indentMatch ? indentMatch[0] : "";
    if(currentLine.match(/<[^/!][^>]*>$/)) indent += "\t";
    this.value = this.value.substring(0,start) + "\n" + indent + this.value.substring(this.selectionEnd);
    this.selectionStart = this.selectionEnd = start + 1 + indent.length;
  }
});
</script>

</body>
</html>
